МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

Кафедра Програмної інженерії

Звіт
з лабораторної роботи №1
з дисципліни: «Скриптові мови програмування»

Виконав:
ст. гр. ПЗПІ-23-3
Білоус А. А.

Перевірив:
Старший викладач кафедри ПІ
Сокорчук І. П.

Харків -- 2025


== Постановка задачі
Лабораторна робота спрямована на розробку консольного PHP-скрипту "Продовольчий магазин "Весна"".

== Хід роботи
=== Створення файлу скрипту
Використаємо команду "touch" для створення файлу скрипту:
```
touch pzpi-23-3-bilous-anton-task3.php
```

Використаємо команду "chmod" для встановлення правильних прав доступу до скрипту:
```
chmod 755 pzpi-23-3-bilous-anton-task3.php
```

Тепер файл "pzpi-23-3-bilous-anton-task3.php" може читати та запускати будь-який користувач, а редагувати тільки його володарь.

=== Аналіз завдання
Програма складається з кількох меню перехід між котрими забезпечує введення чисел написаних перед варіантами меню.

Можна виділити такі основні меню:
- головне меню;
- меню закупок.

Реалізувати ці меню можна за допомогою "while" циклу.

=== Реалізація скрипту
Спочатку вкажемо інтерпретатор для запуску цього скрипту. В цій роботі це PHP:
```
1 #!/usr/bin/env php
2 <?php
```

Після цього встановимо основні параметри:
```
 4 echo <<< EOF
 5   ################################
 6   # ПРОДОВОЛЬЧИЙ МАГАЗИН "ВЕСНА" #
 7   ################################
 8
 9   EOF;
10
11 $main_menu = <<< EOF
12
13   1 Вибрати товари
14   2 Отримати підсумковий рахунок
15   3 Налаштувати свій профіль
16   0 Вийти з програми
17   Введіть команду: 
18   EOF;
19
20 $products = [ // [name, price]
21   ['Молоко пастеризоване',  12],
22   ['Хліб чорний',           9],
23   ['Сир білий',             21],
24   ['Сметана 20%',           25],
25   ['Кефір 1%',              19],
26   ['Вода газована',         18],
27   ['Печиво "Весна"',        14],
28 ];
29
30 $cart = [ /* product id => amount */ ];
```

Тут змінна "\$products" є масивом який містить масиви з назви продукту та ціни, а змінна "\$cart" буде містити номери придбаних продуктів та їх кількість.

Для вирівнювання даних створимо функцію "pad", вона буде приймати строку та бажану довжину, і додавати необхідну кількість пробілів в кінець:
```
32 // pad string with spaces at the end to the length
33 function pad($str, $len) {
34   return $str . str_repeat(' ', max(0, $len - mb_strlen($str)));
35 }
```

Відображати меню продуктів є досить затратним процесом, тому обчислимо результат у змінну "\$products_menu". Спочатку потрібно знайти найдовшу строку в назвах продуктів, а потім пронумерувати кожний продукт з вирівнюванням:
```
37 $products_menu = PHP_EOL;
38
39 $pad_name = 0;
40 $products_number = 0;
41 foreach ($products as $product) {
42   $pad_name = max($pad_name, mb_strlen($product[0]));
43   ++$products_number;
44 }
45
46 $pad_name += 2;
47 $pad_number = strlen($products_number) + 2;
48
49 $products_menu .= pad('№', $pad_number) . pad('НАЗВА', $pad_name) . 'ЦІНА' . PHP_EOL;
50 for ($i = 0; $i < $products_number; ++$i) {
51   $products_menu .= pad($i + 1, $pad_number) . pad($products[$i][0],
52     $pad_name) . $products[$i][1] . PHP_EOL;
53 }
54 $products_menu .= pad('', $pad_number) . '-----------' . PHP_EOL;
55 $products_menu .= pad('0', $pad_number) . 'ПОВЕРНУТИСЯ' . PHP_EOL;
```

Основний цикл програми реалізовано за допомогою простого циклу "while" та конструкції "switch" котра викликає різні функції в залежності від введеного числа:
```
58 while (true) {
59   switch (trim(readline($main_menu))) {
60     case '0': exit(0);
61     case '1': shop();
62       break;
63     case '2': receipt();
64       break;
65     case '3': profile();
66       break;
67     default: echo 'ПОМИЛКА! Введіть правильну команду', PHP_EOL;
68   }
69 }
```

Напишемо функцію другого меню shop. Вона теж використовує цикл "while":
```
71 function shop() {
72   global $products_menu, $products_number, $products, $cart;
73
74   while (true) {
75     echo $products_menu;
```

В цьому циклі після виведення меню котре було обчислено на початку скрипту, потрібно запитати користувача про їх вибір та обробити можливі помилки:
```
77     $choice = trim(readline('Виберіть товар: '));
78     if ($choice == 0) { break; }
79
80     if ($choice < 1 || $choice > $products_number) {
81       echo 'ПОМИЛКА! ВКАЗАНО НЕПРАВИЛЬНИЙ НОМЕР ТОВАРУ', PHP_EOL;
82       continue;
83     }
84     --$choice;
```

Тепер потрібно запитати користувача про кількість продуктів. Для зручності обгорнемо цей процес у ще один "while" цикл в якому виводиться обраний продукт, запитується кількість продуктів, обробляється можлива помилка та в залежності від кількості та стану кошику продукт буде видалений, доданий або створений у кошику.
```
 86     while(true) {
 87       echo PHP_EOL, 'Вибрано: ', $products[$choice][0], PHP_EOL;
 88
 89       $amount = trim(readline('Введіть кількість, штук: '));
 90       if ($amount < 0 || $amount >= 100) {
 91         echo 'ПОМИЛКА! Кількість товару має бути від 1 до 100', PHP_EOL;
 92         continue;
 93       }
 94
 95       if ($amount == 0) {
 96         echo 'ВИДАЛЯЮ З КОШИКА', PHP_EOL;
 97         unset($cart[$choice]);
 98       } else if (array_key_exists($choice, $cart)) {
 99         $cart[$choice] += $amount;
100       } else {
101         $cart[$choice] = $amount;
102       }
103       break;
104     }
```

Після операції над кошиком виведемо його стан. Процес виводу досить схожий до меню закупок, але кошик є динамічним та має адаптуватись до змін при кожному виводі, тому обчислення здійснюється кожного разу:
```
106     if (empty($cart)) {
107       echo 'КОШИК ПОРОЖНІЙ', PHP_EOL;
108       continue;
109     }
110     $pad_name = 0;
111     foreach ($cart as $item => $_) {
112       $pad_name = max($pad_name, mb_strlen($products[$item][0]));
113     }
114     $pad_name += 2;
115     echo PHP_EOL, pad('НАЗВА', $pad_name), 'КІЛЬКІСТЬ', PHP_EOL;
116     foreach ($cart as $item => $amount) {
117       echo pad($products[$item][0], $pad_name), $amount, PHP_EOL;
118     }
119   }
120 }
```

Після закупів клієнт має мати можливість побачити рахунок. Функція відображення рахунку є комбінацією обчислень відображення меню закупів та статусу кошику.

```
122 function receipt() {
123   global $products, $cart;
124
125   if (empty($cart)) {
126     echo 'КОШИК ПОРОЖНІЙ', PHP_EOL;
127     return;
128   }
```

Знайдемо найдовшу назву продукту та підрахуємо кількість продуктів:
```
130   $pad_name = 0;
131   $products_number = 0;
132   foreach ($cart as $item => $_) {
133     $pad_name = max($pad_name, mb_strlen($products[$item][0]));
134     ++$products_number;
135   }
136
137   $pad_name += 2;
138   $pad_number = strlen($products_number) + 2;
```

Роздрукуємо відформатовану таблицю рахунку:
```
141   echo PHP_EOL, pad('№', $pad_number), pad('НАЗВА', $pad_name), 'ЦІНА  КІЛЬКІСТЬ  ВАРТІСТЬ', PHP_EOL;
142
143   $i = 0;
144   $total = 0;
145   foreach ($cart as $item => $amount) {
146     $price = $products[$item][1];
147     $total += $price * $amount;
148
149     echo pad(++$i, $pad_number), pad($products[$item][0], $pad_name),
150     pad($price, 6), pad($amount, 11), $price * $amount, PHP_EOL;
151   }
152   echo 'РАЗОМ ДО CПЛАТИ: ', $total, PHP_EOL;
153 }
```

Додамо функцію для створення профілю користувачем. Ім'я має мати хоча б одну літеру, а вік має бути від 7 до 150 років:
```
155 function profile() {
156   while (!preg_match('/[a-zа-яґїіє]/iu', trim(readline("\nВаше імʼя: ")))) { // u for utf8
157     echo 'ПОМИЛКА! Імʼя користувача не може бути порожнім і повинно містити хоча б одну літеру', PHP_EOL;
158   }
159
160   $age = trim(readline('Ваш вік: '));
161   while ($age < 7 || $age > 150) {
162     echo 'ПОМИЛКА! Користувач не може бути молодшим 7-ми або старшим 150-ти років', PHP_EOL, PHP_EOL;
163     $age = trim(readline('Ваш вік: '));
164   }
165 }
```


== Висновки
Реалізоване програмне забезпечення відповідає поставленим вимогам до лабораторної роботи. Було вивчено основні принципи роботи з PHP для написання консольних програм та проведена оптимізація процесів які можуть впливати на швидкодію програми.


ДОДАТОК А
Результат виконання програми
```
> php pzpi-23-3-bilous-anton-task3.php
################################
# ПРОДОВОЛЬЧИЙ МАГАЗИН "ВЕСНА" #
################################

1 Вибрати товари
2 Отримати підсумковий рахунок
3 Налаштувати свій профіль
0 Вийти з програми
Введіть команду: 1

№  НАЗВА                 ЦІНА
1  Молоко пастеризоване  12
2  Хліб чорний           9
3  Сир білий             21
4  Сметана 20%           25
5  Кефір 1%              19
6  Вода газована         18
7  Печиво "Весна"        14
   -----------
0  ПОВЕРНУТИСЯ
Виберіть товар: 1

Вибрано: Молоко пастеризоване
Введіть кількість, штук: 3

НАЗВА                 КІЛЬКІСТЬ
Молоко пастеризоване  3

№  НАЗВА                 ЦІНА
1  Молоко пастеризоване  12
2  Хліб чорний           9
3  Сир білий             21
4  Сметана 20%           25
5  Кефір 1%              19
6  Вода газована         18
7  Печиво "Весна"        14
   -----------
0  ПОВЕРНУТИСЯ
Виберіть товар: 2

Вибрано: Хліб чорний
Введіть кількість, штук: 1

НАЗВА                 КІЛЬКІСТЬ
Молоко пастеризоване  3
Хліб чорний           1

№  НАЗВА                 ЦІНА
1  Молоко пастеризоване  12
2  Хліб чорний           9
3  Сир білий             21
4  Сметана 20%           25
5  Кефір 1%              19
6  Вода газована         18
7  Печиво "Весна"        14
   -----------
0  ПОВЕРНУТИСЯ
Виберіть товар: 7

Вибрано: Печиво "Весна"
Введіть кількість, штук: 10

НАЗВА                 КІЛЬКІСТЬ
Молоко пастеризоване  3
Хліб чорний           1
Печиво "Весна"        10

№  НАЗВА                 ЦІНА
1  Молоко пастеризоване  12
2  Хліб чорний           9
3  Сир білий             21
4  Сметана 20%           25
5  Кефір 1%              19
6  Вода газована         18
7  Печиво "Весна"        14
   -----------
0  ПОВЕРНУТИСЯ
Виберіть товар: 7

Вибрано: Печиво "Весна"
Введіть кількість, штук: 0
ВИДАЛЯЮ З КОШИКА

НАЗВА                 КІЛЬКІСТЬ
Молоко пастеризоване  3
Хліб чорний           1

№  НАЗВА                 ЦІНА
1  Молоко пастеризоване  12
2  Хліб чорний           9
3  Сир білий             21
4  Сметана 20%           25
5  Кефір 1%              19
6  Вода газована         18
7  Печиво "Весна"        14
   -----------
0  ПОВЕРНУТИСЯ
Виберіть товар: 0

1 Вибрати товари
2 Отримати підсумковий рахунок
3 Налаштувати свій профіль
0 Вийти з програми
Введіть команду: 2

№  НАЗВА                 ЦІНА  КІЛЬКІСТЬ  ВАРТІСТЬ
1  Молоко пастеризоване  12    3          36
2  Хліб чорний           9     1          9
РАЗОМ ДО CПЛАТИ: 45

1 Вибрати товари
2 Отримати підсумковий рахунок
3 Налаштувати свій профіль
0 Вийти з програми
Введіть команду: 3

Ваше імʼя: 42
ПОМИЛКА! Імʼя користувача не може бути порожнім і повинно містити хоча б одну літеру

Ваше імʼя: Ян
Ваш вік: 180
ПОМИЛКА! Користувач не може бути молодшим 7-ми або старшим 150-ти років

Ваш вік: 18

1 Вибрати товари
2 Отримати підсумковий рахунок
3 Налаштувати свій профіль
0 Вийти з програми
Введіть команду: 0
```

ДОДАТОК Б
Код скрипту
```
  1 #!/usr/bin/env php
  2 <?php
  3
  4 echo <<< EOF
  5   ################################
  6   # ПРОДОВОЛЬЧИЙ МАГАЗИН "ВЕСНА" #
  7   ################################
  8
  9   EOF;
 10
 11 $main_menu = <<< EOF
 12
 13   1 Вибрати товари
 14   2 Отримати підсумковий рахунок
 15   3 Налаштувати свій профіль
 16   0 Вийти з програми
 17   Введіть команду:·
 18   EOF;
 19
 20 $products = [ // [name, price]
 21   ['Молоко пастеризоване',  12],
 22   ['Хліб чорний',           9],
 23   ['Сир білий',             21],
 24   ['Сметана 20%',           25],
 25   ['Кефір 1%',              19],
 26   ['Вода газована',         18],
 27   ['Печиво "Весна"',        14],
 28 ];
 29
 30 $cart = [ /* product id => amount */ ];
 31
 32 // pad string with spaces at the end to the length
 33 function pad($str, $len) {
 34   return $str . str_repeat(' ', max(0, $len - mb_strlen($str)));
 35 }
 36
 37 $products_menu = PHP_EOL;
 38
 39 $pad_name = 0;
 40 $products_number = 0;
 41 foreach ($products as $product) {
 42   $pad_name = max($pad_name, mb_strlen($product[0]));
 43   ++$products_number;
 44 }
 45
 46 $pad_name += 2;
 47 $pad_number = strlen($products_number) + 2;
 48
 49 $products_menu .= pad('№', $pad_number) . pad('НАЗВА', $pad_name) . 'ЦІНА' . PHP_EOL;
 50 for ($i = 0; $i < $products_number; ++$i) {
 51   $products_menu .= pad($i + 1, $pad_number) . pad($products[$i][0],
 52     $pad_name) . $products[$i][1] . PHP_EOL;
 53 }
 54 $products_menu .= pad('', $pad_number) . '-----------' . PHP_EOL;
 55 $products_menu .= pad('0', $pad_number) . 'ПОВЕРНУТИСЯ' . PHP_EOL;
 56
 57
 58 while (true) {
 59   switch (trim(readline($main_menu))) {
 60     case '0': exit(0);
 61     case '1': shop();
 62       break;
 63     case '2': receipt();
 64       break;
 65     case '3': profile();
 66       break;
 67     default: echo 'ПОМИЛКА! Введіть правильну команду', PHP_EOL;
 68   }
 69 }
 70
 71 function shop() {
 72   global $products_menu, $products_number, $products, $cart;
 73
 74   while (true) {
 75     echo $products_menu;
 76
 77     $choice = trim(readline('Виберіть товар: '));
 78     if ($choice == 0) { break; }
 79
 80     if ($choice < 1 || $choice > $products_number) {
 81       echo 'ПОМИЛКА! ВКАЗАНО НЕПРАВИЛЬНИЙ НОМЕР ТОВАРУ', PHP_EOL;
 82       continue;
 83     }
 84     --$choice;
 85
 86     while(true) {
 87       echo PHP_EOL, 'Вибрано: ', $products[$choice][0], PHP_EOL;
 88
 89       $amount = trim(readline('Введіть кількість, штук: '));
 90       if ($amount < 0 || $amount >= 100) {
 91         echo 'ПОМИЛКА! Кількість товару має бути від 1 до 100', PHP_EOL;
 92         continue;
 93       }
 94
 95       if ($amount == 0) {
 96         echo 'ВИДАЛЯЮ З КОШИКА', PHP_EOL;
 97         unset($cart[$choice]);
 98       } else if (array_key_exists($choice, $cart)) {
 99         $cart[$choice] += $amount;
100       } else {
101         $cart[$choice] = $amount;
102       }
103       break;
104     }
105
106     if (empty($cart)) {
107       echo 'КОШИК ПОРОЖНІЙ', PHP_EOL;
108       continue;
109     }
110     $pad_name = 0;
111     foreach ($cart as $item => $_) {
112       $pad_name = max($pad_name, mb_strlen($products[$item][0]));
113     }
114     $pad_name += 2;
115     echo PHP_EOL, pad('НАЗВА', $pad_name), 'КІЛЬКІСТЬ', PHP_EOL;
116     foreach ($cart as $item => $amount) {
117       echo pad($products[$item][0], $pad_name), $amount, PHP_EOL;
118     }
119   }
120 }
121
122 function receipt() {
123   global $products, $cart;
124
125   if (empty($cart)) {
126     echo 'КОШИК ПОРОЖНІЙ', PHP_EOL;
127     return;
128   }
129
130   $pad_name = 0;
131   $products_number = 0;
132   foreach ($cart as $item => $_) {
133     $pad_name = max($pad_name, mb_strlen($products[$item][0]));
134     ++$products_number;
135   }
136
137   $pad_name += 2;
138   $pad_number = strlen($products_number) + 2;
139
140
141   echo PHP_EOL, pad('№', $pad_number), pad('НАЗВА', $pad_name), 'ЦІНА  КІЛЬКІСТЬ  ВАРТІСТЬ', PHP_EOL;
142
143   $i = 0;
144   $total = 0;
145   foreach ($cart as $item => $amount) {
146     $price = $products[$item][1];
147     $total += $price * $amount;
148
149     echo pad(++$i, $pad_number), pad($products[$item][0], $pad_name),
150     pad($price, 6), pad($amount, 11), $price * $amount, PHP_EOL;
151   }
152   echo 'РАЗОМ ДО CПЛАТИ: ', $total, PHP_EOL;
153 }
154
155 function profile() {156   while (!preg_match('/[a-zа-яґїіє]/iu', trim(readline("\nВаше імʼя: ")))) { // u for utf8
157     echo 'ПОМИЛКА! Імʼя користувача не може бути порожнім і повинно містити хоча б одну літеру', PHP_EOL;
158   }
159
160   $age = trim(readline('Ваш вік: '));
161   while ($age < 7 || $age > 150) {
162     echo 'ПОМИЛКА! Користувач не може бути молодшим 7-ми або старшим 150-ти років', PHP_EOL, PHP_EOL;
163     $age = trim(readline('Ваш вік: '));
164   }
165 }
```
